---
title: "Catching up on the Tidyverse"
author: "Seth Goldman"
date: '2020-10-03'
slug: catching-up-on-the-tidyverse
categories: []
tags: []
---

<script src="/rmarkdown-libs/kePrint/kePrint.js"></script>
<link href="/rmarkdown-libs/lightable/lightable.css" rel="stylesheet" />


<p>When I first started learning R a few years ago, I focused on picking up the fundamentals of Base R, as well as the <a href="https://tidyverse.org">Tidyverse</a> set of packages, concurrently. Early on, I made a point of writing as much of my code within the Tidyverse framework as possible, favoring the readability and supportive online community.</p>
<p>More recently, I’ve realized that I haven’t kept up with many of the enhancements that the Tidyverse and RStudio team have released. The two types of functionality I’d like to catch up on via this post are <code>tidyselect</code> and dplyr’s <code>across()</code>.</p>
<div id="tidyselect" class="section level2">
<h2>Tidyselect</h2>
<p>Tidy selection refers to the the tidy evaluation method of choosing variables, and is used in functions like <code>select()</code>, <code>rename()</code>, <code>pull()</code>, and <code>across()</code>. There’s a great primer on <em>tidy evaluation</em> in the <a href="https://dplyr.tidyverse.org/articles/programming.html"><code>vignette("programming")</code></a>.</p>
<p>Many functions that use tidy selection will include a <code>&lt;tidy-select&gt;</code> parameter, which means that inputs must be provided in the <strong>tidyselect specification</strong>.</p>
<p>Using the <code>dplyr</code>’s <a href="https://dplyr.tidyverse.org/reference/dplyr_tidy_select.html"><code>tidy-select reference</code></a>, I’ll test some of this functionality on <code>dplyr</code>’s built-in <em>storms</em> dataset.</p>
<div id="the-storms-dataset" class="section level5">
<h5>The Storms Dataset</h5>
<p>Sample of 5 rows:</p>
<table class=" lightable-paper lightable-hover" style='font-family: "Arial Narrow", arial, helvetica, sans-serif; width: auto !important; margin-left: auto; margin-right: auto;'>
<thead>
<tr>
<th style="text-align:left;">
name
</th>
<th style="text-align:right;">
year
</th>
<th style="text-align:right;">
month
</th>
<th style="text-align:right;">
day
</th>
<th style="text-align:right;">
hour
</th>
<th style="text-align:right;">
lat
</th>
<th style="text-align:right;">
long
</th>
<th style="text-align:left;">
status
</th>
<th style="text-align:left;">
category
</th>
<th style="text-align:right;">
wind
</th>
<th style="text-align:right;">
pressure
</th>
<th style="text-align:right;">
ts_diameter
</th>
<th style="text-align:right;">
hu_diameter
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Emily
</td>
<td style="text-align:right;">
1993
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
12
</td>
<td style="text-align:right;">
31.8
</td>
<td style="text-align:right;">
-71.4
</td>
<td style="text-align:left;">
hurricane
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
75
</td>
<td style="text-align:right;">
975
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
Katia
</td>
<td style="text-align:right;">
2011
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
12
</td>
<td style="text-align:right;">
38.5
</td>
<td style="text-align:right;">
-67.1
</td>
<td style="text-align:left;">
hurricane
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
75
</td>
<td style="text-align:right;">
961
</td>
<td style="text-align:right;">
437.2964
</td>
<td style="text-align:right;">
120.8319
</td>
</tr>
<tr>
<td style="text-align:left;">
Debby
</td>
<td style="text-align:right;">
2006
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
24
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
18.4
</td>
<td style="text-align:right;">
-33.9
</td>
<td style="text-align:left;">
tropical storm
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:right;">
45
</td>
<td style="text-align:right;">
1000
</td>
<td style="text-align:right;">
80.5546
</td>
<td style="text-align:right;">
0.0000
</td>
</tr>
<tr>
<td style="text-align:left;">
Maria
</td>
<td style="text-align:right;">
2011
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
18
</td>
<td style="text-align:right;">
13.2
</td>
<td style="text-align:right;">
-52.1
</td>
<td style="text-align:left;">
tropical storm
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:right;">
40
</td>
<td style="text-align:right;">
1004
</td>
<td style="text-align:right;">
155.3553
</td>
<td style="text-align:right;">
0.0000
</td>
</tr>
<tr>
<td style="text-align:left;">
Danny
</td>
<td style="text-align:right;">
1991
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
10.4
</td>
<td style="text-align:right;">
-25.8
</td>
<td style="text-align:left;">
tropical depression
</td>
<td style="text-align:left;">
-1
</td>
<td style="text-align:right;">
25
</td>
<td style="text-align:right;">
1010
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
</tbody>
</table>
</div>
<div id="selection-helpers" class="section level3">
<h3>Selection Helpers</h3>
</div>
<div id="everything" class="section level3">
<h3><code>everything()</code></h3>
<p>Select all variables.</p>
<pre class="r"><code>storm_sample %&gt;% 
  select(everything()) </code></pre>
<table class=" lightable-paper lightable-hover" style='font-family: "Arial Narrow", arial, helvetica, sans-serif; width: auto !important; margin-left: auto; margin-right: auto;'>
<thead>
<tr>
<th style="text-align:left;">
name
</th>
<th style="text-align:right;">
year
</th>
<th style="text-align:right;">
month
</th>
<th style="text-align:right;">
day
</th>
<th style="text-align:right;">
hour
</th>
<th style="text-align:right;">
lat
</th>
<th style="text-align:right;">
long
</th>
<th style="text-align:left;">
status
</th>
<th style="text-align:left;">
category
</th>
<th style="text-align:right;">
wind
</th>
<th style="text-align:right;">
pressure
</th>
<th style="text-align:right;">
ts_diameter
</th>
<th style="text-align:right;">
hu_diameter
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Emily
</td>
<td style="text-align:right;">
1993
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
12
</td>
<td style="text-align:right;">
31.8
</td>
<td style="text-align:right;">
-71.4
</td>
<td style="text-align:left;">
hurricane
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
75
</td>
<td style="text-align:right;">
975
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
Katia
</td>
<td style="text-align:right;">
2011
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
12
</td>
<td style="text-align:right;">
38.5
</td>
<td style="text-align:right;">
-67.1
</td>
<td style="text-align:left;">
hurricane
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
75
</td>
<td style="text-align:right;">
961
</td>
<td style="text-align:right;">
437.2964
</td>
<td style="text-align:right;">
120.8319
</td>
</tr>
<tr>
<td style="text-align:left;">
Debby
</td>
<td style="text-align:right;">
2006
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
24
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
18.4
</td>
<td style="text-align:right;">
-33.9
</td>
<td style="text-align:left;">
tropical storm
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:right;">
45
</td>
<td style="text-align:right;">
1000
</td>
<td style="text-align:right;">
80.5546
</td>
<td style="text-align:right;">
0.0000
</td>
</tr>
<tr>
<td style="text-align:left;">
Maria
</td>
<td style="text-align:right;">
2011
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
18
</td>
<td style="text-align:right;">
13.2
</td>
<td style="text-align:right;">
-52.1
</td>
<td style="text-align:left;">
tropical storm
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:right;">
40
</td>
<td style="text-align:right;">
1004
</td>
<td style="text-align:right;">
155.3553
</td>
<td style="text-align:right;">
0.0000
</td>
</tr>
<tr>
<td style="text-align:left;">
Danny
</td>
<td style="text-align:right;">
1991
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
10.4
</td>
<td style="text-align:right;">
-25.8
</td>
<td style="text-align:left;">
tropical depression
</td>
<td style="text-align:left;">
-1
</td>
<td style="text-align:right;">
25
</td>
<td style="text-align:right;">
1010
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
</tbody>
</table>
</div>
<div id="last_col" class="section level3">
<h3><code>last_col()</code></h3>
<p>Select variable that matches the last column.</p>
<pre class="r"><code>storm_sample %&gt;% 
  select(last_col())</code></pre>
<table class=" lightable-paper lightable-hover" style='font-family: "Arial Narrow", arial, helvetica, sans-serif; width: auto !important; margin-left: auto; margin-right: auto;'>
<thead>
<tr>
<th style="text-align:right;">
hu_diameter
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
120.8319
</td>
</tr>
<tr>
<td style="text-align:right;">
0.0000
</td>
</tr>
<tr>
<td style="text-align:right;">
0.0000
</td>
</tr>
<tr>
<td style="text-align:right;">
NA
</td>
</tr>
</tbody>
</table>
</div>
<div id="using-last_col-with-an-offset" class="section level3">
<h3>Using <code>last_col()</code>, with an offset</h3>
<p>Select the last column, with an offset by position (i.e., the three positions from last column – the fourth from last).</p>
<pre class="r"><code>storm_sample %&gt;% 
  select(last_col(offset = 3))</code></pre>
<table class=" lightable-paper lightable-hover" style='font-family: "Arial Narrow", arial, helvetica, sans-serif; width: auto !important; margin-left: auto; margin-right: auto;'>
<thead>
<tr>
<th style="text-align:right;">
wind
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
75
</td>
</tr>
<tr>
<td style="text-align:right;">
75
</td>
</tr>
<tr>
<td style="text-align:right;">
45
</td>
</tr>
<tr>
<td style="text-align:right;">
40
</td>
</tr>
<tr>
<td style="text-align:right;">
25
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="selection-with-pattern-matching" class="section level2">
<h2>Selection with Pattern Matching</h2>
<div id="starts_with" class="section level3">
<h3>starts_with()</h3>
<p>Select variables that start with a given prefix.</p>
<pre class="r"><code>storm_sample %&gt;% 
  select(starts_with(&quot;l&quot;))</code></pre>
<table class=" lightable-paper lightable-hover" style='font-family: "Arial Narrow", arial, helvetica, sans-serif; width: auto !important; margin-left: auto; margin-right: auto;'>
<thead>
<tr>
<th style="text-align:right;">
lat
</th>
<th style="text-align:right;">
long
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
31.8
</td>
<td style="text-align:right;">
-71.4
</td>
</tr>
<tr>
<td style="text-align:right;">
38.5
</td>
<td style="text-align:right;">
-67.1
</td>
</tr>
<tr>
<td style="text-align:right;">
18.4
</td>
<td style="text-align:right;">
-33.9
</td>
</tr>
<tr>
<td style="text-align:right;">
13.2
</td>
<td style="text-align:right;">
-52.1
</td>
</tr>
<tr>
<td style="text-align:right;">
10.4
</td>
<td style="text-align:right;">
-25.8
</td>
</tr>
</tbody>
</table>
</div>
<div id="ends_with" class="section level3">
<h3>ends_with()</h3>
<p>Select variables that end with a given suffix.</p>
<pre class="r"><code>storm_sample %&gt;% 
  select(ends_with(&quot;r&quot;))</code></pre>
<table class=" lightable-paper lightable-hover" style='font-family: "Arial Narrow", arial, helvetica, sans-serif; width: auto !important; margin-left: auto; margin-right: auto;'>
<thead>
<tr>
<th style="text-align:right;">
year
</th>
<th style="text-align:right;">
hour
</th>
<th style="text-align:right;">
ts_diameter
</th>
<th style="text-align:right;">
hu_diameter
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1993
</td>
<td style="text-align:right;">
12
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
2011
</td>
<td style="text-align:right;">
12
</td>
<td style="text-align:right;">
437.2964
</td>
<td style="text-align:right;">
120.8319
</td>
</tr>
<tr>
<td style="text-align:right;">
2006
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
80.5546
</td>
<td style="text-align:right;">
0.0000
</td>
</tr>
<tr>
<td style="text-align:right;">
2011
</td>
<td style="text-align:right;">
18
</td>
<td style="text-align:right;">
155.3553
</td>
<td style="text-align:right;">
0.0000
</td>
</tr>
<tr>
<td style="text-align:right;">
1991
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
</tbody>
</table>
</div>
<div id="contains" class="section level3">
<h3>contains()</h3>
<p>Select varibles that contain a literal string.</p>
<pre class="r"><code>storm_sample %&gt;% 
  select(contains(&quot;sure&quot;))</code></pre>
<table class=" lightable-paper lightable-hover" style='font-family: "Arial Narrow", arial, helvetica, sans-serif; width: auto !important; margin-left: auto; margin-right: auto;'>
<thead>
<tr>
<th style="text-align:right;">
pressure
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
975
</td>
</tr>
<tr>
<td style="text-align:right;">
961
</td>
</tr>
<tr>
<td style="text-align:right;">
1000
</td>
</tr>
<tr>
<td style="text-align:right;">
1004
</td>
</tr>
<tr>
<td style="text-align:right;">
1010
</td>
</tr>
</tbody>
</table>
</div>
<div id="matches" class="section level3">
<h3>matches()</h3>
<p>Select variables that match a regular expression.</p>
<pre class="r"><code>storm_sample %&gt;% 
  select(matches(&quot;[aeiou]&quot;))</code></pre>
<table class=" lightable-paper lightable-hover" style='font-family: "Arial Narrow", arial, helvetica, sans-serif; width: auto !important; margin-left: auto; margin-right: auto;'>
<thead>
<tr>
<th style="text-align:left;">
name
</th>
<th style="text-align:right;">
year
</th>
<th style="text-align:right;">
month
</th>
<th style="text-align:right;">
day
</th>
<th style="text-align:right;">
hour
</th>
<th style="text-align:right;">
lat
</th>
<th style="text-align:right;">
long
</th>
<th style="text-align:left;">
status
</th>
<th style="text-align:left;">
category
</th>
<th style="text-align:right;">
wind
</th>
<th style="text-align:right;">
pressure
</th>
<th style="text-align:right;">
ts_diameter
</th>
<th style="text-align:right;">
hu_diameter
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Emily
</td>
<td style="text-align:right;">
1993
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
12
</td>
<td style="text-align:right;">
31.8
</td>
<td style="text-align:right;">
-71.4
</td>
<td style="text-align:left;">
hurricane
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
75
</td>
<td style="text-align:right;">
975
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
Katia
</td>
<td style="text-align:right;">
2011
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
12
</td>
<td style="text-align:right;">
38.5
</td>
<td style="text-align:right;">
-67.1
</td>
<td style="text-align:left;">
hurricane
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
75
</td>
<td style="text-align:right;">
961
</td>
<td style="text-align:right;">
437.2964
</td>
<td style="text-align:right;">
120.8319
</td>
</tr>
<tr>
<td style="text-align:left;">
Debby
</td>
<td style="text-align:right;">
2006
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
24
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
18.4
</td>
<td style="text-align:right;">
-33.9
</td>
<td style="text-align:left;">
tropical storm
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:right;">
45
</td>
<td style="text-align:right;">
1000
</td>
<td style="text-align:right;">
80.5546
</td>
<td style="text-align:right;">
0.0000
</td>
</tr>
<tr>
<td style="text-align:left;">
Maria
</td>
<td style="text-align:right;">
2011
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
18
</td>
<td style="text-align:right;">
13.2
</td>
<td style="text-align:right;">
-52.1
</td>
<td style="text-align:left;">
tropical storm
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:right;">
40
</td>
<td style="text-align:right;">
1004
</td>
<td style="text-align:right;">
155.3553
</td>
<td style="text-align:right;">
0.0000
</td>
</tr>
<tr>
<td style="text-align:left;">
Danny
</td>
<td style="text-align:right;">
1991
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
10.4
</td>
<td style="text-align:right;">
-25.8
</td>
<td style="text-align:left;">
tropical depression
</td>
<td style="text-align:left;">
-1
</td>
<td style="text-align:right;">
25
</td>
<td style="text-align:right;">
1010
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
</tbody>
</table>
</div>
<div id="num_range" class="section level3">
<h3>num_range()</h3>
<p>Select variables that match a numerical range, like x01, x02, x03.</p>
<pre class="r"><code>storm_sample %&gt;% 
  mutate(&quot;some_string1&quot; = 1,
         &quot;some_string2&quot; = 0) %&gt;% 
  select(num_range(prefix = &quot;some_string&quot;,
                   range = 1:5))</code></pre>
<table class=" lightable-paper lightable-hover" style='font-family: "Arial Narrow", arial, helvetica, sans-serif; width: auto !important; margin-left: auto; margin-right: auto;'>
<thead>
<tr>
<th style="text-align:right;">
some_string1
</th>
<th style="text-align:right;">
some_string2
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="selection-using-character-vectors" class="section level2">
<h2>Selection using character vectors</h2>
<div id="all_of" class="section level3">
<h3>all_of()</h3>
<p>Matches variable names in a character vector. All names must be present, otherwise an out-of-bounds error is thrown.</p>
<pre class="r"><code># Assign a vector of arbitrary variables to vrbls
vrbls &lt;- c(&quot;year&quot;,&quot;wind&quot;,&quot;status&quot;)

storm_sample %&gt;% 
  select(all_of(vrbls))</code></pre>
<table class=" lightable-paper lightable-hover" style='font-family: "Arial Narrow", arial, helvetica, sans-serif; width: auto !important; margin-left: auto; margin-right: auto;'>
<thead>
<tr>
<th style="text-align:right;">
year
</th>
<th style="text-align:right;">
wind
</th>
<th style="text-align:left;">
status
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1993
</td>
<td style="text-align:right;">
75
</td>
<td style="text-align:left;">
hurricane
</td>
</tr>
<tr>
<td style="text-align:right;">
2011
</td>
<td style="text-align:right;">
75
</td>
<td style="text-align:left;">
hurricane
</td>
</tr>
<tr>
<td style="text-align:right;">
2006
</td>
<td style="text-align:right;">
45
</td>
<td style="text-align:left;">
tropical storm
</td>
</tr>
<tr>
<td style="text-align:right;">
2011
</td>
<td style="text-align:right;">
40
</td>
<td style="text-align:left;">
tropical storm
</td>
</tr>
<tr>
<td style="text-align:right;">
1991
</td>
<td style="text-align:right;">
25
</td>
<td style="text-align:left;">
tropical depression
</td>
</tr>
</tbody>
</table>
</div>
<div id="any_of" class="section level3">
<h3>any_of()</h3>
<p>Same as all_of(), except that no error is thrown for names that don’t exist.</p>
<pre class="r"><code># Add a variable outside the scope of the dataset
vrbls2 &lt;- c(vrbls, &quot;dog&quot;)

storm_sample %&gt;% 
  select(any_of(vrbls2))</code></pre>
<table class=" lightable-paper lightable-hover" style='font-family: "Arial Narrow", arial, helvetica, sans-serif; width: auto !important; margin-left: auto; margin-right: auto;'>
<thead>
<tr>
<th style="text-align:right;">
year
</th>
<th style="text-align:right;">
wind
</th>
<th style="text-align:left;">
status
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1993
</td>
<td style="text-align:right;">
75
</td>
<td style="text-align:left;">
hurricane
</td>
</tr>
<tr>
<td style="text-align:right;">
2011
</td>
<td style="text-align:right;">
75
</td>
<td style="text-align:left;">
hurricane
</td>
</tr>
<tr>
<td style="text-align:right;">
2006
</td>
<td style="text-align:right;">
45
</td>
<td style="text-align:left;">
tropical storm
</td>
</tr>
<tr>
<td style="text-align:right;">
2011
</td>
<td style="text-align:right;">
40
</td>
<td style="text-align:left;">
tropical storm
</td>
</tr>
<tr>
<td style="text-align:right;">
1991
</td>
<td style="text-align:right;">
25
</td>
<td style="text-align:left;">
tropical depression
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="selection-of-variables-within-a-function" class="section level2">
<h2>Selection of variables within a function</h2>
<div id="where" class="section level3">
<h3>where()</h3>
<p>Applies a function to all variables and selects those for which the function returns TRUE.</p>
<p>Common use case: selecting columns of a specific data type</p>
<pre class="r"><code>storm_sample %&gt;% 
  select(where(is.factor))</code></pre>
<table class=" lightable-paper lightable-hover" style='font-family: "Arial Narrow", arial, helvetica, sans-serif; width: auto !important; margin-left: auto; margin-right: auto;'>
<thead>
<tr>
<th style="text-align:left;">
category
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
-1
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="embracing-i.e.-var" class="section level2">
<h2>Embracing (i.e., {{var}})</h2>
<p>Using <code>{{ double curly brace }}</code> syntax (<a href="https://www.tidyverse.org/blog/2019/06/rlang-0-4-0/#a-simpler-interpolation-pattern-with">pronounced ‘curly curly’</a>) allows users to provide a variable that can be passed into a function that uses data masking or tidy selection. This helps make functions much more extensible to many types of inputs.</p>
<pre class="r"><code>calculateMean &lt;- function(data, variable){
  
  data %&gt;% 
    summarize(&quot;mean&quot; = mean({{variable}}))
  
}

calculateMean(storm_sample, pressure)</code></pre>
<pre><code>## # A tibble: 1 x 1
##    mean
##   &lt;dbl&gt;
## 1   990</code></pre>
<p>This example allows a user to pass an entire dataframe into a function, and randomly sample a number of rows, as provided by the user.</p>
<pre class="r"><code>mySample &lt;- function(df, n_rows){
  
  {{df}} %&gt;% 
    sample_n(size = {{n_rows}})
}

mySample(storms, 3)</code></pre>
<table class=" lightable-paper lightable-hover" style='font-family: "Arial Narrow", arial, helvetica, sans-serif; width: auto !important; margin-left: auto; margin-right: auto;'>
<thead>
<tr>
<th style="text-align:left;">
name
</th>
<th style="text-align:right;">
year
</th>
<th style="text-align:right;">
month
</th>
<th style="text-align:right;">
day
</th>
<th style="text-align:right;">
hour
</th>
<th style="text-align:right;">
lat
</th>
<th style="text-align:right;">
long
</th>
<th style="text-align:left;">
status
</th>
<th style="text-align:left;">
category
</th>
<th style="text-align:right;">
wind
</th>
<th style="text-align:right;">
pressure
</th>
<th style="text-align:right;">
ts_diameter
</th>
<th style="text-align:right;">
hu_diameter
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Georges
</td>
<td style="text-align:right;">
1980
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
18
</td>
<td style="text-align:right;">
16.8
</td>
<td style="text-align:right;">
-42.1
</td>
<td style="text-align:left;">
tropical depression
</td>
<td style="text-align:left;">
-1
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
1010
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
Iris
</td>
<td style="text-align:right;">
1995
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
23.8
</td>
<td style="text-align:right;">
-61.8
</td>
<td style="text-align:left;">
hurricane
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
70
</td>
<td style="text-align:right;">
977
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
Emily
</td>
<td style="text-align:right;">
1987
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
24
</td>
<td style="text-align:right;">
18
</td>
<td style="text-align:right;">
26.0
</td>
<td style="text-align:right;">
-72.0
</td>
<td style="text-align:left;">
tropical storm
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:right;">
45
</td>
<td style="text-align:right;">
1002
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
</tbody>
</table>
</div>
<div id="across" class="section level1">
<h1>Across</h1>
<p>According to the <a href="https://dplyr.tidyverse.org/reference/across.html">dplyr documentation</a>, <code>across()</code> provides an easy interface to apply the same transformation to multiple columns.</p>
<div id="apply-a-calculation-function-to-multiple-columns" class="section level3">
<h3>Apply a calculation function to multiple columns</h3>
<p>Calculating the mean of all Integer columns, grouping by the Storm’s category:</p>
<table class=" lightable-paper lightable-hover" style='font-family: "Arial Narrow", arial, helvetica, sans-serif; width: auto !important; margin-left: auto; margin-right: auto;'>
<thead>
<tr>
<th style="text-align:left;">
category
</th>
<th style="text-align:right;">
day
</th>
<th style="text-align:right;">
wind
</th>
<th style="text-align:right;">
pressure
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
-1
</td>
<td style="text-align:right;">
15.95953
</td>
<td style="text-align:right;">
27.26916
</td>
<td style="text-align:right;">
1007.6259
</td>
</tr>
<tr>
<td style="text-align:left;">
0
</td>
<td style="text-align:right;">
15.71553
</td>
<td style="text-align:right;">
45.80037
</td>
<td style="text-align:right;">
999.3291
</td>
</tr>
<tr>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
16.22433
</td>
<td style="text-align:right;">
70.91098
</td>
<td style="text-align:right;">
981.5181
</td>
</tr>
<tr>
<td style="text-align:left;">
2
</td>
<td style="text-align:right;">
16.23089
</td>
<td style="text-align:right;">
89.43471
</td>
<td style="text-align:right;">
967.4729
</td>
</tr>
<tr>
<td style="text-align:left;">
3
</td>
<td style="text-align:right;">
15.55647
</td>
<td style="text-align:right;">
104.64187
</td>
<td style="text-align:right;">
953.5289
</td>
</tr>
<tr>
<td style="text-align:left;">
4
</td>
<td style="text-align:right;">
14.39655
</td>
<td style="text-align:right;">
121.55172
</td>
<td style="text-align:right;">
939.5345
</td>
</tr>
<tr>
<td style="text-align:left;">
5
</td>
<td style="text-align:right;">
18.00000
</td>
<td style="text-align:right;">
145.07353
</td>
<td style="text-align:right;">
916.4265
</td>
</tr>
</tbody>
</table>
</div>
<div id="transform-all-columns-of-a-certain-datatype-to-another-datatype" class="section level3">
<h3>Transform all columns of a certain datatype to another datatype</h3>
<p>Coercing all <strong>factor</strong> columns to <strong>string</strong> datatypes:</p>
<pre class="r"><code>storms %&gt;% 
  mutate(across(is.factor,as.character)) %&gt;% 
  glimpse()</code></pre>
<pre><code>## Rows: 10,010
## Columns: 13
## $ name        &lt;chr&gt; &quot;Amy&quot;, &quot;Amy&quot;, &quot;Amy&quot;, &quot;Amy&quot;, &quot;Amy&quot;, &quot;Amy&quot;, &quot;Amy&quot;, &quot;Amy&quot;,...
## $ year        &lt;dbl&gt; 1975, 1975, 1975, 1975, 1975, 1975, 1975, 1975, 1975, 1...
## $ month       &lt;dbl&gt; 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 7, 7, 7...
## $ day         &lt;int&gt; 27, 27, 27, 27, 28, 28, 28, 28, 29, 29, 29, 29, 30, 30,...
## $ hour        &lt;dbl&gt; 0, 6, 12, 18, 0, 6, 12, 18, 0, 6, 12, 18, 0, 6, 12, 18,...
## $ lat         &lt;dbl&gt; 27.5, 28.5, 29.5, 30.5, 31.5, 32.4, 33.3, 34.0, 34.4, 3...
## $ long        &lt;dbl&gt; -79.0, -79.0, -79.0, -79.0, -78.8, -78.7, -78.0, -77.0,...
## $ status      &lt;chr&gt; &quot;tropical depression&quot;, &quot;tropical depression&quot;, &quot;tropical...
## $ category    &lt;chr&gt; &quot;-1&quot;, &quot;-1&quot;, &quot;-1&quot;, &quot;-1&quot;, &quot;-1&quot;, &quot;-1&quot;, &quot;-1&quot;, &quot;-1&quot;, &quot;0&quot;, &quot;0...
## $ wind        &lt;int&gt; 25, 25, 25, 25, 25, 25, 25, 30, 35, 40, 45, 50, 50, 55,...
## $ pressure    &lt;int&gt; 1013, 1013, 1013, 1013, 1012, 1012, 1011, 1006, 1004, 1...
## $ ts_diameter &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,...
## $ hu_diameter &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,...</code></pre>
</div>
<div id="running-multiple-named-functions-on-multiple-columns" class="section level3">
<h3>Running multiple named functions on multiple columns:</h3>
<p>Calculating the minimum, maximum, standard deviation, and mean of columns that start with the letter “L.”</p>
<pre class="r"><code>storms %&gt;% 
  group_by(category) %&gt;% 
  summarize(across(starts_with(&quot;l&quot;), list(min_val = min,
                                         max_val = max,
                                         std_dev = sd,
                                         avg = mean)))</code></pre>
<table class=" lightable-paper lightable-hover" style='font-family: "Arial Narrow", arial, helvetica, sans-serif; width: auto !important; margin-left: auto; margin-right: auto;'>
<thead>
<tr>
<th style="text-align:left;">
category
</th>
<th style="text-align:right;">
lat_min_val
</th>
<th style="text-align:right;">
lat_max_val
</th>
<th style="text-align:right;">
lat_std_dev
</th>
<th style="text-align:right;">
lat_avg
</th>
<th style="text-align:right;">
long_min_val
</th>
<th style="text-align:right;">
long_max_val
</th>
<th style="text-align:right;">
long_std_dev
</th>
<th style="text-align:right;">
long_avg
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
-1
</td>
<td style="text-align:right;">
7.2
</td>
<td style="text-align:right;">
46.5
</td>
<td style="text-align:right;">
8.186093
</td>
<td style="text-align:right;">
22.59057
</td>
<td style="text-align:right;">
-109.3
</td>
<td style="text-align:right;">
-6.0
</td>
<td style="text-align:right;">
22.91269
</td>
<td style="text-align:right;">
-66.72035
</td>
</tr>
<tr>
<td style="text-align:left;">
0
</td>
<td style="text-align:right;">
8.9
</td>
<td style="text-align:right;">
51.9
</td>
<td style="text-align:right;">
8.684703
</td>
<td style="text-align:right;">
24.79042
</td>
<td style="text-align:right;">
-102.6
</td>
<td style="text-align:right;">
-12.8
</td>
<td style="text-align:right;">
19.33437
</td>
<td style="text-align:right;">
-63.21717
</td>
</tr>
<tr>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
9.5
</td>
<td style="text-align:right;">
50.8
</td>
<td style="text-align:right;">
8.647063
</td>
<td style="text-align:right;">
28.31751
</td>
<td style="text-align:right;">
-99.2
</td>
<td style="text-align:right;">
-18.5
</td>
<td style="text-align:right;">
17.02850
</td>
<td style="text-align:right;">
-61.39223
</td>
</tr>
<tr>
<td style="text-align:left;">
2
</td>
<td style="text-align:right;">
9.8
</td>
<td style="text-align:right;">
45.3
</td>
<td style="text-align:right;">
7.687820
</td>
<td style="text-align:right;">
26.94252
</td>
<td style="text-align:right;">
-97.8
</td>
<td style="text-align:right;">
-30.6
</td>
<td style="text-align:right;">
16.85885
</td>
<td style="text-align:right;">
-63.10127
</td>
</tr>
<tr>
<td style="text-align:left;">
3
</td>
<td style="text-align:right;">
10.2
</td>
<td style="text-align:right;">
43.5
</td>
<td style="text-align:right;">
6.377100
</td>
<td style="text-align:right;">
24.27906
</td>
<td style="text-align:right;">
-97.8
</td>
<td style="text-align:right;">
-31.4
</td>
<td style="text-align:right;">
14.48734
</td>
<td style="text-align:right;">
-67.95785
</td>
</tr>
<tr>
<td style="text-align:left;">
4
</td>
<td style="text-align:right;">
10.6
</td>
<td style="text-align:right;">
38.8
</td>
<td style="text-align:right;">
4.483112
</td>
<td style="text-align:right;">
20.50259
</td>
<td style="text-align:right;">
-98.0
</td>
<td style="text-align:right;">
-32.2
</td>
<td style="text-align:right;">
13.38570
</td>
<td style="text-align:right;">
-67.89425
</td>
</tr>
<tr>
<td style="text-align:left;">
5
</td>
<td style="text-align:right;">
13.7
</td>
<td style="text-align:right;">
27.2
</td>
<td style="text-align:right;">
3.822346
</td>
<td style="text-align:right;">
19.73382
</td>
<td style="text-align:right;">
-97.1
</td>
<td style="text-align:right;">
-54.6
</td>
<td style="text-align:right;">
10.35117
</td>
<td style="text-align:right;">
-78.14559
</td>
</tr>
</tbody>
</table>
</div>
<div id="row-wise-calculations-with-c_across" class="section level3">
<h3>Row-wise calculations with <strong>c_across()</strong></h3>
<p>Though uncommon, there may be instances where we need to do calculations on a row-by-row basis. <code>dplyr</code> provides a variation of <code>across()</code> to accomplish this: <code>c_across()</code>.</p>
<p>Starting with a simple transform of the <code>storms</code> dataset, where each row will be a year, each column will be the category of storm, and each value represents the average wind speed for the corresponding year and category. The transformed dataset will be called <code>windy_years</code>.</p>
<p>For the sake of example, calculate a somewhat meaningless row-wise mean on each row of this table – assigning the value to <code>avg</code>.</p>
<pre class="r"><code>windy_years %&gt;% 
  sample_n(10) %&gt;% # sample 10 rows
  rowwise() %&gt;% 
  mutate(&quot;avg&quot; = mean(
              c_across(everything()),
              na.rm = TRUE)
         ) %&gt;% 
  kableExtra::kbl() %&gt;% 
  kable_paper(&quot;hover&quot;, full_width = F)</code></pre>
<table class=" lightable-paper lightable-hover" style='font-family: "Arial Narrow", arial, helvetica, sans-serif; width: auto !important; margin-left: auto; margin-right: auto;'>
<thead>
<tr>
<th style="text-align:right;">
year
</th>
<th style="text-align:right;">
-1
</th>
<th style="text-align:right;">
0
</th>
<th style="text-align:right;">
1
</th>
<th style="text-align:right;">
2
</th>
<th style="text-align:right;">
3
</th>
<th style="text-align:right;">
4
</th>
<th style="text-align:right;">
5
</th>
<th style="text-align:right;">
avg
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1997
</td>
<td style="text-align:right;">
25.93023
</td>
<td style="text-align:right;">
43.28571
</td>
<td style="text-align:right;">
68.75000
</td>
<td style="text-align:right;">
92.50000
</td>
<td style="text-align:right;">
106.6667
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
389.0221
</td>
</tr>
<tr>
<td style="text-align:right;">
1994
</td>
<td style="text-align:right;">
24.86111
</td>
<td style="text-align:right;">
43.89535
</td>
<td style="text-align:right;">
68.33333
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
532.7724
</td>
</tr>
<tr>
<td style="text-align:right;">
1979
</td>
<td style="text-align:right;">
25.03788
</td>
<td style="text-align:right;">
45.12048
</td>
<td style="text-align:right;">
70.90000
</td>
<td style="text-align:right;">
87.30769
</td>
<td style="text-align:right;">
103.3333
</td>
<td style="text-align:right;">
122.3077
</td>
<td style="text-align:right;">
145.7143
</td>
<td style="text-align:right;">
322.3402
</td>
</tr>
<tr>
<td style="text-align:right;">
1977
</td>
<td style="text-align:right;">
25.93750
</td>
<td style="text-align:right;">
45.00000
</td>
<td style="text-align:right;">
70.35714
</td>
<td style="text-align:right;">
87.50000
</td>
<td style="text-align:right;">
110.0000
</td>
<td style="text-align:right;">
120.0000
</td>
<td style="text-align:right;">
145.0000
</td>
<td style="text-align:right;">
322.5993
</td>
</tr>
<tr>
<td style="text-align:right;">
1981
</td>
<td style="text-align:right;">
25.86957
</td>
<td style="text-align:right;">
45.96154
</td>
<td style="text-align:right;">
71.62162
</td>
<td style="text-align:right;">
89.11765
</td>
<td style="text-align:right;">
103.1250
</td>
<td style="text-align:right;">
115.0000
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
347.3851
</td>
</tr>
<tr>
<td style="text-align:right;">
2012
</td>
<td style="text-align:right;">
28.12500
</td>
<td style="text-align:right;">
48.33333
</td>
<td style="text-align:right;">
70.41667
</td>
<td style="text-align:right;">
89.56522
</td>
<td style="text-align:right;">
100.0000
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
391.4067
</td>
</tr>
<tr>
<td style="text-align:right;">
1992
</td>
<td style="text-align:right;">
27.85714
</td>
<td style="text-align:right;">
46.32353
</td>
<td style="text-align:right;">
71.47059
</td>
<td style="text-align:right;">
89.60000
</td>
<td style="text-align:right;">
105.0000
</td>
<td style="text-align:right;">
122.0833
</td>
<td style="text-align:right;">
145.0000
</td>
<td style="text-align:right;">
324.9168
</td>
</tr>
<tr>
<td style="text-align:right;">
2001
</td>
<td style="text-align:right;">
27.17593
</td>
<td style="text-align:right;">
47.43671
</td>
<td style="text-align:right;">
71.81159
</td>
<td style="text-align:right;">
89.68750
</td>
<td style="text-align:right;">
103.8889
</td>
<td style="text-align:right;">
119.0000
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
351.4287
</td>
</tr>
<tr>
<td style="text-align:right;">
1993
</td>
<td style="text-align:right;">
28.39623
</td>
<td style="text-align:right;">
45.27778
</td>
<td style="text-align:right;">
70.76923
</td>
<td style="text-align:right;">
89.00000
</td>
<td style="text-align:right;">
100.0000
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
387.7405
</td>
</tr>
<tr>
<td style="text-align:right;">
1990
</td>
<td style="text-align:right;">
27.56637
</td>
<td style="text-align:right;">
45.51020
</td>
<td style="text-align:right;">
69.13333
</td>
<td style="text-align:right;">
89.00000
</td>
<td style="text-align:right;">
101.2500
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
387.0767
</td>
</tr>
</tbody>
</table>
</div>
<div id="wrapping-up" class="section level2">
<h2>Wrapping up</h2>
<p>Though I expect to benefit from all of these enhancements, I think tidy selection will have the most immediate impact. Many of my analysis workflows involve transforming large datasets with many columns into easier-to-work-with tables with the columns that are relevant to my analysis. Tidy selection makes it possible to do this with limited hard-coding. I also expect to use across() in place of repetitive code where I calculate measures on multiple columns. Finally, I think I’ll be able to make many of my analysis scripts more concise, combining many existing functions into fewer generalized functions – all thanks to my new friend <code>{{ curly curly }}</code> syntax.</p>
</div>
</div>
